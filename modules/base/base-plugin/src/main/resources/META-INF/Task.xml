<!--
  - Copyright 2013-2021 consulo.io
  -
  - Licensed under the Apache License, Version 2.0 (the "License");
  - you may not use this file except in compliance with the License.
  - You may obtain a copy of the License at
  -
  - http://www.apache.org/licenses/LICENSE-2.0
  -
  - Unless required by applicable law or agreed to in writing, software
  - distributed under the License is distributed on an "AS IS" BASIS,
  - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  - See the License for the specific language governing permissions and
  - limitations under the License.
  -->
<consulo-plugin>
  <actions>

    <group id="task.actions">
      <action id="tasks.switch" class="com.intellij.tasks.actions.SwitchTaskAction" text="_Switch Task...">
        <keyboard-shortcut keymap="$default" first-keystroke="alt shift T"/>
      </action>
      <action id="tasks.goto" class="com.intellij.tasks.actions.GotoTaskAction">
        <keyboard-shortcut keymap="$default" first-keystroke="alt shift N"/>
      </action>
      <action id="tasks.close" class="com.intellij.tasks.actions.CloseTaskAction" text="_Close Active Task...">
        <keyboard-shortcut keymap="$default" first-keystroke="alt shift W"/>
      </action>
      <separator/>
      <action id="tasks.create.changelist" class="com.intellij.tasks.actions.CreateChangelistAction" text="Create Change_list..."/>
      <action id="tasks.show.task.description" class="com.intellij.tasks.actions.ShowTaskDescription" text="Show Description"/>
      <action id="tasks.open.in.browser" class="com.intellij.tasks.actions.OpenTaskInBrowserAction" text="Open in _Browser">
        <keyboard-shortcut keymap="$default" first-keystroke="alt shift B"/>
      </action>
      <action id="tasks.analyze.stacktrace" class="com.intellij.tasks.actions.AnalyzeTaskStacktraceAction" text="Analyze _Stacktrace From Task..."/>
      <separator/>
      <action id="tasks.configure.servers" class="com.intellij.tasks.actions.ConfigureServersAction" text="Configure Servers..."/>
    </group>

    <group id="working.context">
      <action id="context.save" class="com.intellij.tasks.actions.context.SaveContextAction" text="_Save Context...">
        <keyboard-shortcut keymap="$default" first-keystroke="alt shift S"/>
      </action>
      <action id="context.load" class="com.intellij.tasks.actions.context.LoadContextAction" text="_Load Context...">
        <keyboard-shortcut keymap="$default" first-keystroke="alt shift L"/>
        <keyboard-shortcut keymap="Mac OS X" first-keystroke="alt shift L" remove="true"/>
      </action>
      <action id="context.clear" class="com.intellij.tasks.actions.context.ClearContextAction" text="_Clear Context">
        <keyboard-shortcut keymap="$default" first-keystroke="alt shift X"/>
      </action>
    </group>

    <group id="tasks.and.contexts" text="_Tasks &amp; Contexts" popup="true">
      <reference ref="task.actions"/>
      <separator/>
      <reference ref="working.context"/>
    </group>

    <group id="tasks.group">
      <reference ref="tasks.and.contexts"/>
      <separator/>
      <add-to-group group-id="ToolsMenu" anchor="first"/>
    </group>

    <group id="tasks.toolbar.group" text="Tasks toolbar">
      <separator/>
      <action id="tasks.switch.toolbar" class="com.intellij.tasks.actions.SwitchTaskCombo" text="Switch Task">
        <keyboard-shortcut keymap="$default" first-keystroke="alt shift T"/>
      </action>
      <add-to-group group-id="MainToolBar" anchor="last"/>
      <add-to-group group-id="NavBarToolBarOthers" anchor="last"/>
    </group>


    <action id="tasks.trackContext" class="com.intellij.tasks.actions.AssociateWithTaskAction"
        text="Associate with _Task"
        description="Reload context (e.g. open editors) when changelist is set active">

      <add-to-group group-id="ChangesViewPopupMenu" relative-to-action="ChangesView.SetDefault" anchor="after"/>
    </action>
  </actions>

  <extensionPoints>
    <extensionPoint name="tasks.repositoryType" interface="com.intellij.tasks.TaskRepositoryType"/>
    <extensionPoint name="tasks.contextProvider" area="PROJECT" interface="com.intellij.tasks.context.WorkingContextProvider"/>
    <extensionPoint name="tasks.dialogPanelProvider" interface="com.intellij.tasks.ui.TaskDialogPanelProvider"/>
  </extensionPoints>

  <extensions defaultExtensionNs="com.intellij">

    <projectConfigurable instance="com.intellij.tasks.config.TaskConfigurable" id="tasks" displayName="Tasks" nonDefaultProject="true">
      <configurable instance="com.intellij.tasks.config.TaskRepositoriesConfigurable" displayName="Servers" id="tasks.servers"/>
    </projectConfigurable>

    <editChangelistSupport implementation="com.intellij.tasks.impl.TaskChangelistSupport"/>

    <projectService serviceImplementation="com.intellij.tasks.impl.TaskProjectConfiguration"/>
    <projectService serviceImplementation="com.intellij.tasks.context.WorkingContextManager"/>
    <applicationService serviceImplementation="com.intellij.tasks.config.RecentTaskRepositories"/>
    <applicationService serviceImplementation="com.intellij.tasks.config.TaskSettings"/>

    <lang.documentationProvider language="TEXT" implementationClass="com.intellij.tasks.doc.TaskDocumentationProvider"/>

    <!--context providers-->
    <tasks.contextProvider implementation="com.intellij.tasks.context.OpenEditorsContextProvider"/>
    <tasks.contextProvider implementation="com.intellij.tasks.context.ProjectViewContextProvider"/>
    <tasks.contextProvider implementation="com.intellij.tasks.context.RunConfigurationsContextProvider"/>
    <tasks.contextProvider implementation="com.intellij.tasks.context.XDebuggerBreakpointsContextProvider"/>

    <checkinHandlerFactory implementation="com.intellij.tasks.impl.TaskCheckinHandlerFactory"/>



    <projectConfigurable instance="com.intellij.tasks.timeTracking.TimeTrackingConfigurable" displayName="Time Tracking"
                         id="tasks.timeTracking"
                         nonDefaultProject="true"
                         parentId="tasks"/>

    <toolWindow id="Time Tracking" anchor="right" secondary="false" icon="consulo.task.impl.TaskImplIconGroup@clock"
                factoryClass="com.intellij.tasks.timeTracking.TasksToolWindowFactory"
                canCloseContents="false"
                conditionClass="com.intellij.tasks.timeTracking.TasksToolWindowFactory"/>

    <changeListDecorator implementation="consulo.tasks.impl.TaskChangeListDecorator"/>

    <projectService serviceImplementation="com.intellij.tasks.timeTracking.TimeTrackingManager" lazy="false"/>
    <projectService serviceInterface="com.intellij.tasks.TaskManager" serviceImplementation="com.intellij.tasks.impl.TaskManagerImpl"/>
  </extensions>

</consulo-plugin>
